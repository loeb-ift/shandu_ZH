# Shandu 項目概述

Shandu 是一個先進的 AI 研究系統，專為綜合知識合成而設計。根據程式碼庫中的資訊，Shandu 是一個基於 LLM（大型語言模型）的智能研究系統，能夠自動化完成從初始查詢到深入內容分析和報告生成的全面研究過程。

## 主要功能

Shandu 系統具有以下主要功能：

- **基於狀態的工作流程**：利用 LangGraph 實現結構化、逐步的研究過程，具有明確的狀態轉換。
- **迭代深度探索**：透過動態深度和廣度遞歸探索主題，適應發現的資訊。
- **多源資訊合成**：分析來自搜尋引擎、網頁內容和結構化知識庫的資料。
- **增強型網頁抓取**：具備動態 JS 渲染、內容提取和道德抓取實踐。
- **智能來源評估**：自動評估來源的可信度、相關性和資訊價值。
- **內容分析管道**：使用高級 NLP 提取關鍵內容、識別模式並綜合發現。
- **全面報告生成**：創建詳細、結構良好的報告，並附上適當的引用和主題組織。

## 研究工作流程

Shandu 實現了一個複雜的多階段研究流程：

1. **查詢澄清**：透過互動問題了解研究需求。
2. **研究規劃**：為全面主題覆蓋進行戰略規劃。
3. **迭代探索**：
   - 基於知識空白的智能查詢生成。
   - 進行並行執行的多引擎搜尋。
   - 搜尋結果的相關性過濾。
   - 具備內容提取的智能網頁抓取。
   - 來源可信度評估。
   - 資訊分析和綜合。
   - 對於發現的反思以識別空白。
4. **報告生成**：
   - 主題提取和組織。
   - 多步報告增強。
   - 引用格式化和管理。
   - 全面覆蓋的章節擴展。

## 工作流程

1. **初始化**：研究過程從用戶的查詢和初步參數開始。
2. 初始化節點 (Initialize Node) 詳細說明

在 Shandu 研究系統中，初始化節點 (initialize_node) 是研究工作流程的第一個步驟，負責建立研究計劃並設置初始狀態。這個節點在 LangGraph 狀態圖中作為入口點，為整個研究過程奠定基礎。

功能與目的
初始化節點的主要功能是：

創建結構化的研究計劃，包括研究目標、關鍵研究領域、研究方法和預期成果
設置研究狀態的初始值
記錄研究開始時間和當前日期
為後續節點準備必要的上下文 initialize.py:36-41
實現細節
初始化節點通過以下步驟工作：

設置初始狀態：記錄開始時間、設置狀態為「初始化中」，並記錄當前日期 initialize.py:38-41
生成研究計劃：使用 LLM 生成詳細的研究計劃，包含以下部分：
研究目標 (Objectives)
需要調查的關鍵領域 (Key Areas)
研究方法 (Methodology)
預期成果 (Expected Outcomes) initialize.py:43-65
解析研究計劃：使用正則表達式從 LLM 回應中提取結構化信息 initialize.py:71-94
設置默認值：如果某些部分未能從 LLM 回應中提取，則設置默認值 initialize.py:96-103
格式化研究計劃：將提取的信息格式化為 Markdown 格式 initialize.py:105-119
更新狀態：將研究計劃添加到狀態中，為後續節點準備 initialize.py:121-123
提示詞設計
初始化節點使用特定的提示詞來指導 LLM 生成研究計劃。這些提示詞強調：

嚴格遵循研究計劃的結構
考慮當前日期的相關性
詳細分解查詢為子主題和目標
識別潛在的信息來源和研究角度
考慮多種觀點並明確承認任何偏見
制定從多種來源驗證收集信息的策略 prompts.py:100-106
在工作流程中的位置
初始化節點是研究工作流程的入口點，在 LangGraph 狀態圖中設置為第一個執行的節點： langgraph_agent.py:71 langgraph_agent.py:83-94

初始化完成後，工作流程會進入查詢生成節點 (Generate Queries)，開始實際的研究過程。

輸出示例
初始化節點的輸出是一個結構化的研究計劃，格式如下：

# Research Plan  
  
## Objectives  
- 理解[查詢主題]的關鍵方面  
- 分析[查詢主題]的當前應用和挑戰  
- 評估[查詢主題]的未來發展趨勢  
- 識別[查詢主題]的最佳實踐和案例研究  
  
## Key Areas to Investigate  
- [查詢主題]的基本概念和定義  
- 當前應用和實例  
- 技術挑戰和限制  
- 行業趨勢和未來發展  
- 相關法規和標準  
  
## Methodology  
系統性地審查可用文獻，分析當前應用和實例，評估專家觀點，並綜合多種來源的信息以提供全面的理解。  
  
## Expected Outcomes  
- [查詢主題]的全面理解  
- 識別關鍵挑戰和機會  
- 當前最佳實踐的概述  
- 未來發展趨勢的預測
與其他組件的集成

初始化節點與 Shandu 系統的其他組件緊密集成：

ResearchGraph：初始化節點是 ResearchGraph 工作流程的第一個節點 langgraph_agent.py:83-84
AgentState：初始化節點更新 AgentState 對象，該對象在整個研究過程中維護狀態 initialize.py:36
LLM：初始化節點使用語言模型生成研究計劃 initialize.py:43-67
3. **生成查詢**：系統根據上下文生成針對性的搜尋查詢。
4. **搜尋**：執行搜尋查詢並處理結果。
5. **反思**：分析發現並識別知識空白。
6. **循環**：步驟 2-4 重複，直到達到足夠的深度。
7. **智能來源選擇**：篩選並優先考慮最有價值的來源。
8. **格式化引用**：準備正確格式化的引用。
9. **報告生成**：從初稿到最終報告的多階段過程。


    A[初始化] --> B[生成查詢]
    B --> C[搜尋]
    C --> D[反思]
    D --> E[循環]
    E --> B
    E --> F[智能來源選擇]
    F --> G[格式化引用]
    G --> H[報告生成]



## 系統架構

研究系統採用模組化、狀態驅動的架構來有效管理研究工作流程。其核心是一個協調不同研究狀態之間轉換的有向圖實現。系統包括以下關鍵組件：

- **ResearchGraph**：主要協調器，使用 LangGraph 的基於狀態的架構定義研究工作流程，管理不同研究階段之間的轉換。
- **ResearchAgent**：執行特定研究任務，包括搜尋、內容分析和知識提取，並與 AISearcher 和 WebScraper 等外部系統介面。
- **AgentState**：維護研究過程狀態的資料結構，包括累積知識、搜尋結果和進度追蹤。
- **研究節點**：處理研究過程中特定階段的專門組件：
  - 初始化：設定研究上下文。
  - 反思：分析當前知識以識別空白。
  - 生成查詢：創建有針對性的搜尋查詢。
  - 搜尋：從多個來源檢索資訊。
  - 來源選擇：識別最相關的來源。
  - 引用：管理來源的適當歸屬。
  - 報告生成：創建最終研究輸出。

## 使用方法

Shandu 可以透過命令列介面或 Python API 使用：

### 命令列介面

```bash
# 配置 API 設定（支持各種 LLM 提供商）  
shandu configure  
  
# 進行全面研究  
shandu research "您的研究查詢" --depth 2 --breadth 4 --output report.md  
  
# 快速 AI 驅動搜尋與網頁抓取  
shandu aisearch "誰是美國現任總統？" --detailed  
  
# 基本多引擎搜尋  
shandu search "您的搜尋查詢"
## 使用方法

以下是如何使用 Shandu 進行深度研究的範例代碼：

```python
from shandu.agents import ResearchGraph  
from langchain_openai import ChatOpenAI  
  
# 如果需要，使用自定義 LLM 初始化  
llm = ChatOpenAI(model="gpt-4")  
  
# 初始化研究圖  
researcher = ResearchGraph(  
    llm=llm,  
    temperature=0.5  
)  
  
# 執行深度研究  
results = researcher.research_sync(  
    query="您的研究查詢",  
    depth=3,       # 迴圈研究的深度  
    breadth=4,     # 要探索的並行查詢數量  
    detail_level="high"  
)  
  
# 打印或保存結果  
print(results.to_markdown())```

